commands:
  create_post_dir:
    command: "mkdir /opt/elasticbeanstalk/hooks/appdeploy/post"
    ignoreErrors: true
  create_hippo_storage:
    command: "mkdir /var/lib/hippostorage -p"  
    ignoreErrors: true
  set_storage_rights:
    command: "chown webapp.webapp /var/lib/hippostorage -R"
    ignoreErrors: true
files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_restart_delayed_job.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/usr/bin/env bash
      su -c "cd /var/app/current && ./bin/shutdown.sh" webapp
      sleep 20
      PID=$(ps ax | grep tomcat | head -n1 | cut -d' ' -f1)
      kill -9 $PID
      su -c "cd /var/app/current && ./bin/startup.sh" webapp
